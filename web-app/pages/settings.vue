<template>
	<div>
		<div class="main-box relative z-0">
			<div class="text-xl mb-4 font-semibold">Your profile</div>
			<div class="input-form-box mb-8">
				<input
					id="email_settings"
					type="text"
					class="outline-none w-full disabled:opacity-40"
					:value="store.user.email"
					disabled
				/>
			</div>
			<div class="input-form-box mb-8">
				<input
					id="password_settings"
					type="text"
					class="outline-none w-full disabled:opacity-40"
					placeholder="PASSWORD"
					disabled
				/>
			</div>
			<div class="flex justify-center">
				<div class="group">
					<button
						disabled
						id="update_button"
						type="button"
						@click="register"
						class="btn bg-amber-500 group-hover:bg-amber-600 disabled:opacity-40"
					>
						Save
					</button>
					<button disabled class="drop-shadow-box"></button>
				</div>
			</div>
			<div class="text-xl mb-4 font-semibold mt-4">
				Your connected accounts
			</div>
			<div
				v-for="account in store.accounts"
				:key="account"
				class="md:grid grid-cols-3 gap-4 my-2 mx-4 place-items-center hidden"
			>
				<div>
					<Icon
						:name="
							'mingcute:' +
							account.provider.toLowerCase() +
							'-line'
						"
						class="w-8 h-8"
						color="#FFB100"
					/>
					<span class="text-md mx-2">{{ account.userId }}</span>
				</div>

				<div class="group">
					<button
						:id="'disconnect_button' + account.provider"
						type="button"
						@click="disconnect(account)"
						class="btn bg-amber-500 group-hover:bg-amber-600"
					>
						Disconnect
					</button>
					<div class="invisible md:visible drop-shadow-box"></div>
				</div>
			</div>
			<div
				v-for="account in store.accounts"
				:key="account"
				class="grid grid-cols-2 my-2 place-items-center md:hidden"
			>
				<div>
					<Icon
						:name="
							'mingcute:' +
							account.provider.toLowerCase() +
							'-line'
						"
						class="w-8 h-8"
						color="#FFB100"
					/>
					<span class="text-md mx-2">{{ account.userId }}</span>
				</div>
				<div class="group">
					<button
						:id="'disconnect_button' + account.provider"
						type="button"
						@click="disconnect(account)"
						class="btn bg-amber-500 group-hover:bg-amber-600"
					>
						Disconnect
					</button>
					<div class="invisible md:visible drop-shadow-box"></div>
				</div>
			</div>
		</div>
	</div>
</template>
<script>
import { useMainStore } from "../store/main";
import Providers from "../services/providers";

definePageMeta({
	middleware: "auth",
});

export default {
	name: "Settings",
	middleware: "auth",
	setup() {
		const store = useMainStore();

		async function disconnect(account) {
			console.log(store.token);
			const response = await Providers.updateUser(
				store.user.id,
				{
					socialNetworks: [],
					twitterCodeVerifier: null,
					twitterSessionState: null,
					twitterAccessToken: null,
					twitterRefreshToken: null,
					twitterId: null,
					twitterUsername: null,
				},
				store.token
			);
			if (response.status == 200) {
				store.increment();
				store.removeAccount(account);
				return;
			} else {
				console.log(response);
			}
		}

		return { store, disconnect };
	},
};
</script>
<style></style>
